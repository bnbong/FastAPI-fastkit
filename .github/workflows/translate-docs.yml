name: Translate Documentation

on:
  workflow_dispatch:
    inputs:
      target_language:
        description: 'Target language code (e.g., ko, ja, zh). Leave empty for all languages.'
        required: false
        type: string
      api_provider:
        description: 'AI API provider for translation'
        required: true
        type: choice
        options:
          - openai
          - anthropic
        default: openai
      specific_files:
        description: 'Specific files to translate (space-separated, relative to docs/en/). Example: index.md user-guide/installation.md'
        required: false
        type: string
      create_pr:
        description: 'Create Pull Request for translations'
        required: true
        type: boolean
        default: true

  # Trigger on new documentation commits (optional - uncomment to enable)
  # push:
  #   branches:
  #     - main
  #   paths:
  #     - 'docs/en/**/*.md'  # Only trigger on English documentation changes

jobs:
  translate:
    runs-on: ubuntu-latest

    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install openai anthropic

      - name: Configure Git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

      - name: Run translation
        env:
          TRANSLATION_API_KEY: ${{ secrets.TRANSLATION_API_KEY }}
        run: |
          ARGS="--api-provider ${{ inputs.api_provider }}"

          if [ -n "${{ inputs.target_language }}" ]; then
            ARGS="$ARGS --target-lang ${{ inputs.target_language }}"
          fi

          if [ -n "${{ inputs.specific_files }}" ]; then
            ARGS="$ARGS --files ${{ inputs.specific_files }}"
          fi

          if [ "${{ inputs.create_pr }}" = "false" ]; then
            ARGS="$ARGS --no-pr"
          fi

          python scripts/translate.py $ARGS

      - name: Create Pull Request
        if: inputs.create_pr == true
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "docs: Add ${{ inputs.target_language || 'multi-language' }} translations"
          branch: translation/${{ inputs.target_language || 'auto' }}-${{ github.run_number }}
          delete-branch: true
          title: "[Translation] Add ${{ inputs.target_language || 'multi-language' }} documentation"
          body: |
            ## Automated Translation

            This PR contains automated translations for the documentation.

            ### Translation Details
            - **Target Language**: ${{ inputs.target_language || 'All configured languages' }}
            - **API Provider**: ${{ inputs.api_provider }}
            - **Trigger**: ${{ github.event_name }}
            - **Run ID**: ${{ github.run_id }}

            ### Review Checklist
            - [ ] Markdown formatting is preserved
            - [ ] Code blocks are unchanged
            - [ ] Technical terms are appropriate
            - [ ] Links work correctly
            - [ ] Grammar and spelling are correct

            ### Files Changed
            Please review the translated files for accuracy and consistency.

            ---
            *Generated by GitHub Actions*
          labels: |
            documentation
            translation
            automated
